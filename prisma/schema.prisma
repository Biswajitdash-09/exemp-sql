generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Employee {
  id            String   @id @default(uuid())
  employeeId    String   @unique
  name          String
  email         String
  entityName    String // 'TVSCSHIB' | 'HIB'
  dateOfJoining DateTime
  dateOfLeaving DateTime
  designation   String
  exitReason    String
  fnfStatus     String // 'Completed' | 'Pending'
  department    String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("employees")
}

model Admin {
  id          String    @id @default(uuid())
  username    String    @unique
  email       String    @unique
  password    String
  fullName    String
  role        String // 'super_admin', 'hr_manager', 'hr_staff'
  department  String
  permissions String[]  @default([])
  isActive    Boolean   @default(true)
  lastLoginAt DateTime?
  testMode    Boolean   @default(false)
  bypassToken String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("admins")
}

model Verifier {
  id                   String    @id @default(uuid())
  companyName          String
  email                String    @unique
  password             String
  isEmailVerified      Boolean   @default(false)
  isActive             Boolean   @default(true)
  verificationRequests String[]  @default([])
  notifications        Json[]    @default([])
  lastLoginAt          DateTime?
  testMode             Boolean   @default(false)
  isBgvAgency          Boolean   @default(false)
  bypassToken          String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  @@map("verifiers")
}

model VerificationRecord {
  id                      String   @id @default(uuid())
  verificationId          String   @unique
  employeeId              String
  verifierId              String
  submittedData           Json
  comparisonResults       Json[]   @default([])
  overallStatus           String // 'matched', 'partial_match', 'mismatch'
  matchScore              Float
  consentGiven            Boolean
  pdfReportUrl            String?
  verificationCompletedAt DateTime @default(now())
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@map("verification_records")
}

model Appeal {
  id               String    @id @default(uuid())
  appealId         String    @unique
  verificationId   String
  verifierId       String
  employeeId       String
  appealReason     String
  documents        String[]  @default([])
  mismatchedFields Json[]    @default([])
  status           String    @default("pending") // 'pending', 'under_review', 'approved', 'rejected'
  hrResponse       String?
  hrComments       String?
  reviewedBy       String?
  reviewedAt       DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@map("appeals")
}

model VerificationAttempt {
  id            String    @id @default(uuid())
  verifierId    String
  employeeId    String
  attemptCount  Int       @default(0)
  isBlocked     Boolean   @default(false)
  blockedAt     DateTime?
  lastAttemptAt DateTime  @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([verifierId, employeeId])
  @@map("verification_attempts")
}

model AccessLog {
  id            String   @id @default(uuid())
  email         String
  role          String   @default("unknown")
  action        String   @default("LOGIN")
  status        String
  ipAddress     String?
  userAgent     String?
  failureReason String?
  metadata      Json?
  timestamp     DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("access_logs")
}

model Otp {
  id        String   @id @default(uuid())
  email     String   @unique
  otp       String
  expiresAt DateTime
  attempts  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("otps")
}

model EmailLog {
  id           String   @id @default(uuid())
  provider     String // 'sendgrid', 'brevo', 'resend'
  emailType    String // 'otp', 'welcome', etc.
  recipient    String
  subject      String
  status       String // 'sent', 'failed'
  responseTime Int      @default(0)
  messageId    String?
  error        String?
  metadata     Json     @default("{}")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("email_logs")
}
